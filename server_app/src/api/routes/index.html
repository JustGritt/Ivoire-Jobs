<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <button id="connect">Connect</button>
    <input type="text" id="message" placeholder="Enter message">
    <button id="send">Send</button>
    <div id="log"></div>

    <script>
        let socket;
        const connectButton = document.getElementById('connect');
        const sendButton = document.getElementById('send');
        const messageInput = document.getElementById('message');
        const log = document.getElementById('log');

        connectButton.addEventListener('click', async () => {
            const userID = 'b7a60f50-275e-4cbe-8c10-3a1b4566443a'; // Replace with actual user ID
            const roomID = '05ffb537-27e2-4c83-b938-343da66d162c'; // Replace with actual room ID
            const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NUb2tlbklEIjoiYmNkYjk0MGUtN2FmNS00ZTRjLWFiMTYtMDkzYjQ3ZDAzNmI4IiwidXNlcklEIjoiYjdhNjBmNTAtMjc1ZS00Y2JlLThjMTAtM2ExYjQ1NjY0NDNhIiwicm9sZSI6InN0YW5kYXJkIiwiaXNzIjoibXktYW1hemluZy1jb21wYW55LW5hbWUiLCJleHAiOjE3MjAxMDUyNTh9.OaMMLWOj4py9dh7DUxwf_kp4tqJtojV9NYZqjjhn1NE'; // Replace with actual JWT token

            try {

                // Determine the WebSocket protocol to use
                const protocol = (window.location.protocol === 'https:') ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/api/v1/room/${roomID}/ws?token=${token}`;

                log.innerHTML += `<p>Attempting to connect to WebSocket at ${wsUrl}</p>`;

                socket = new WebSocket(wsUrl);

                socket.onopen = () => {
                    log.innerHTML += '<p>Connected to WebSocket</p>';
                    console.log('WebSocket connection opened.');
                };

                socket.onmessage = (event) => {
                    log.innerHTML += `<p>Received: ${event.data}</p>`;
                    console.log('WebSocket message received:', event.data);
                };

                socket.onclose = (event) => {
                    log.innerHTML += `<p>WebSocket closed (Code: ${event.code}, Reason: ${event.reason})</p>`;
                    console.log('WebSocket connection closed. Code:', event.code, 'Reason:', event.reason);
                };

                socket.onerror = (error) => {
                    log.innerHTML += `<p>Error: ${error.message}</p>`;
                    console.error('WebSocket error:', error);
                };

            } catch (error) {
                log.innerHTML += `<p>Error: ${error.message}</p>`;
                console.error('Error during room fetch or WebSocket connection:', error);
            }
        });

        sendButton.addEventListener('click', () => {
            const message = messageInput.value;
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(message);
                log.innerHTML += `<p>Sent: ${message}</p>`;
                console.log('WebSocket message sent:', message);
            } else {
                log.innerHTML += '<p>WebSocket is not connected</p>';
                console.warn('Attempted to send message, but WebSocket is not connected.');
            }
        });
    </script>
</body>
</html>
